/**
  * UPYUN js-sdk 3.0.0
  * (c) 2017
  * @license MIT
  */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("axios")):"function"==typeof define&&define.amd?define(["axios"],t):e.upyun=t(e.axios)}(this,function(e){"use strict";function t(e,t,n){return new Promise(function(r,o){var i=e.slice||e.mozSlice||e.webkitSlice;return i?r(i.call(e,t,n)):o(new Error("not support File type!"))})}function n(t,n,r){var o=r.authorization,i=r.policy,u=new FormData;return u.append("authorization",o),u.append("policy",i),u.append("file",n),e.post(t,u).then(function(e){var t=e.status;return Promise.resolve(200===t)})}function r(e,t,n,r){function o(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r}function i(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function u(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function a(e,t){return e<<t|e>>>32-t}function s(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var n=[80],r=1732584193,s=-271733879,l=-1732584194,c=271733878,f=-1009589776,d=0;d<e.length;d+=16){for(var h=r,p=s,v=l,g=c,y=f,m=0;m<80;m++){n[m]=m<16?e[d+m]:a(n[m-3]^n[m-8]^n[m-14]^n[m-16],1);var b=u(u(a(r,5),o(m,s,l,c)),u(u(f,n[m]),i(m)));f=c,c=l,l=a(s,30),s=r,r=b}r=u(r,h),s=u(s,p),l=u(l,v),c=u(c,g),f=u(f,y)}return[r,s,l,c,f]}function l(e){for(var t=[],n=(1<<r)-1,o=0;o<e.length*r;o+=r)t[o>>5]|=(e.charCodeAt(o/8)&n)<<32-r-o%32;return t}function c(e,t){var n=l(e);n.length>16&&(n=s(n,e.length*r));for(var o=[16],i=[16],u=0;u<16;u++)o[u]=909522486^n[u],i[u]=1549556828^n[u];var a=s(o.concat(l(t)),512+t.length*r);return s(i.concat(a),672)}function f(e){for(var t="",r=0;r<4*e.length;r+=3)for(var o=(e[r>>2]>>8*(3-r%4)&255)<<16|(e[r+1>>2]>>8*(3-(r+1)%4)&255)<<8|e[r+2>>2]>>8*(3-(r+2)%4)&255,i=0;i<4;i++)8*r+6*i>32*e.length?t+=n:t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(o>>6*(3-i)&63);return t}return n||(n="="),r||(r=8),function(e,t){return f(c(e,t))}(e,t)}function o(e,t){return t={exports:{}},e(t,t.exports),t.exports}function i(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function u(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&i(e.slice(0,0))}function a(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=(new Date).toGMTString();return{Authorization:s(e,{method:t,path:n="/"+e.bucketName+n,date:o,contentMd5:r}),"X-Date":o,"User-Agent":"Js-Sdk/"+m.version}}function s(e,t){var n=[t.method,t.path];["date","policy","contentMd5"].forEach(function(e){t[e]&&n.push(t[e])});var r=v(e.password,n.join("&"));return"UPYUN "+e.operatorName+":"+r}function l(e,t){if(t.bucket=e.bucketName,void 0===t["save-key"])throw new Error("upyun - calclate body sign need save-key");void 0===t.expiration&&(t.expiration=parseInt(new Date/1e3+1800,10));var n=y.encode(JSON.stringify(t));return{policy:n,authorization:s(e,{method:"POST",path:"/"+e.bucketName,policy:n})}}function c(e,t){var n=(new Date).toGMTString(),r=t.join("\n"),o=A(r+"&"+e.bucketName+"&"+n+"&"+e.password);return{Authorization:"UpYun "+e.bucketName+":"+e.operatorName+":"+o,Date:n,"User-Agent":"Js-Sdk/"+m.version}}function f(e){return 0===e.indexOf("x-upyun-meta-")}function d(e,t,n){var r=S.getHeaderSign(e,t,n);return Promise.resolve(r)}e="default"in e?e.default:e;var h=function(t,n,r){var o=e.create({baseURL:t+"/"+n.bucketName});return o.interceptors.request.use(function(e){var t=e.method.toUpperCase();e.url=encodeURI(e.url);var o=e.url.substring(e.baseURL.length);return r(n,t,o).then(function(t){return e.headers.common=t,Promise.resolve(e)})},function(e){throw new Error("upyun - request failed: "+e.message)}),o.interceptors.response.use(function(e){return e},function(e){var t=e.response;if(void 0===t)throw e;if(404!==t.status)throw new Error("upyun - response error: "+t.data.code+" "+t.data.msg);return t}),o},p={readBlockAsync:t},v=r,g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},y=o(function(e,t){!function(n){var r=t,o=e&&e.exports==r&&e,i="object"==typeof g&&g;i.global!==i&&i.window!==i||(n=i);var u=function(e){this.message=e};(u.prototype=new Error).name="InvalidCharacterError";var a=function(e){throw new u(e)},s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=/[\t\n\f\r ]/g,c={encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&a("The string to be encoded contains characters outside of the Latin1 range.");for(var t,n=e.length%3,r="",o=-1,i=e.length-n;++o<i;)t=(e.charCodeAt(o)<<16)+(e.charCodeAt(++o)<<8)+e.charCodeAt(++o),r+=s.charAt(t>>18&63)+s.charAt(t>>12&63)+s.charAt(t>>6&63)+s.charAt(63&t);return 2==n?(t=(e.charCodeAt(o)<<8)+e.charCodeAt(++o),r+=s.charAt(t>>10)+s.charAt(t>>4&63)+s.charAt(t<<2&63)+"="):1==n&&(t=e.charCodeAt(o),r+=s.charAt(t>>2)+s.charAt(t<<4&63)+"=="),r},decode:function(e){var t=(e=String(e).replace(l,"")).length;t%4==0&&(t=(e=e.replace(/==?$/,"")).length),(t%4==1||/[^+a-zA-Z0-9/]/.test(e))&&a("Invalid character: the string to be decoded is not correctly encoded.");for(var n,r,o=0,i="",u=-1;++u<t;)r=s.indexOf(e.charAt(u)),n=o%4?64*n+r:r,o++%4&&(i+=String.fromCharCode(255&n>>(-2*o&6)));return i},version:"0.1.0"};if(r&&!r.nodeType)if(o)o.exports=c;else for(var f in c)c.hasOwnProperty(f)&&(r[f]=c[f]);else n.base64=c}(g)}),m={name:"upyun",version:"3.0.0",description:"UPYUN js sdk",main:"dist/upyun.common.js",scripts:{build:"node build/build.js",test:"npm run test:server && npm run test:client","test:client":"./node_modules/.bin/karma start tests/karma.conf.js","test:server":"./node_modules/.bin/mocha --compilers js:babel-register tests/server/*"},repository:{type:"git",url:"git@github.com:upyun/node-sdk.git"},keywords:["upyun","js","nodejs","sdk","cdn","cloud","storage"],author:"Leigh",license:"MIT",bugs:{url:"https://github.com/upyun/node-sdk/issues"},homepage:"https://github.com/upyun/node-sdk",contributors:[{name:"yejingx",email:"yejingx@gmail.com"},{name:"Leigh",email:"i@zhuli.me"},{name:"kaidiren",email:"kaidiren@gmail.com"},{name:"Gaara",email:"sabakugaara@users.noreply.github.com"}],devDependencies:{"babel-cli":"^6.24.1","babel-loader":"^7.0.0","babel-plugin-external-helpers":"^6.22.0","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.4.0","babel-register":"^6.24.1",chai:"^3.5.0",istanbul:"^0.4.3",karma:"^1.7.0","karma-chrome-launcher":"^2.1.1","karma-mocha":"^1.3.0","karma-sourcemap-loader":"^0.3.7","karma-webpack":"^2.0.3",mocha:"^3.4.1",rollup:"^0.41.6","rollup-plugin-alias":"^1.3.1","rollup-plugin-babel":"^2.7.1","rollup-plugin-commonjs":"^8.0.2","rollup-plugin-json":"^2.1.1","rollup-plugin-node-resolve":"^3.0.0",should:"^9.0.2","uglify-js":"^3.0.11",webpack:"^2.5.1"},dependencies:{axios:"^0.16.1","base-64":"^0.1.0","form-data":"^2.1.4",hmacsha1:"^1.0.0",md5:"^2.2.1","mime-types":"^2.1.15"},browser:{"./upyun/utils.js":"./upyun/browser-utils.js","./upyun/form-upload.js":"./upyun/browser-form-upload.js"},peerDependencies:{"babel-polyfill":"^6.23.0"}},b=o(function(e){!function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&n.rotl(e,8)|4278255360&n.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=e[n]<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<32*e.length;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((15&e[n]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){for(var n=[],r=0;r<e.length;r+=3)for(var o=e[r]<<16|e[r+1]<<8|e[r+2],i=0;i<4;i++)8*r+6*i<=8*e.length?n.push(t.charAt(o>>>6*(3-i)&63)):n.push("=");return n.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var n=[],r=0,o=0;r<e.length;o=++r%4)0!=o&&n.push((t.indexOf(e.charAt(r-1))&Math.pow(2,-2*o+8)-1)<<2*o|t.indexOf(e.charAt(r))>>>6-2*o);return n}};e.exports=n}()}),k={utf8:{stringToBytes:function(e){return k.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(k.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}},w=k,x=function(e){return null!=e&&(i(e)||u(e)||!!e._isBuffer)},A=o(function(e){!function(){var t=b,n=w.utf8,r=x,o=w.bin,i=function(e,u){e.constructor==String?e=u&&"binary"===u.encoding?o.stringToBytes(e):n.stringToBytes(e):r(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||(e=e.toString());for(var a=t.bytesToWords(e),s=8*e.length,l=1732584193,c=-271733879,f=-1732584194,d=271733878,h=0;h<a.length;h++)a[h]=16711935&(a[h]<<8|a[h]>>>24)|4278255360&(a[h]<<24|a[h]>>>8);a[s>>>5]|=128<<s%32,a[14+(s+64>>>9<<4)]=s;for(var p=i._ff,v=i._gg,g=i._hh,y=i._ii,h=0;h<a.length;h+=16){var m=l,b=c,k=f,w=d;c=y(c=y(c=y(c=y(c=g(c=g(c=g(c=g(c=v(c=v(c=v(c=v(c=p(c=p(c=p(c=p(c,f=p(f,d=p(d,l=p(l,c,f,d,a[h+0],7,-680876936),c,f,a[h+1],12,-389564586),l,c,a[h+2],17,606105819),d,l,a[h+3],22,-1044525330),f=p(f,d=p(d,l=p(l,c,f,d,a[h+4],7,-176418897),c,f,a[h+5],12,1200080426),l,c,a[h+6],17,-1473231341),d,l,a[h+7],22,-45705983),f=p(f,d=p(d,l=p(l,c,f,d,a[h+8],7,1770035416),c,f,a[h+9],12,-1958414417),l,c,a[h+10],17,-42063),d,l,a[h+11],22,-1990404162),f=p(f,d=p(d,l=p(l,c,f,d,a[h+12],7,1804603682),c,f,a[h+13],12,-40341101),l,c,a[h+14],17,-1502002290),d,l,a[h+15],22,1236535329),f=v(f,d=v(d,l=v(l,c,f,d,a[h+1],5,-165796510),c,f,a[h+6],9,-1069501632),l,c,a[h+11],14,643717713),d,l,a[h+0],20,-373897302),f=v(f,d=v(d,l=v(l,c,f,d,a[h+5],5,-701558691),c,f,a[h+10],9,38016083),l,c,a[h+15],14,-660478335),d,l,a[h+4],20,-405537848),f=v(f,d=v(d,l=v(l,c,f,d,a[h+9],5,568446438),c,f,a[h+14],9,-1019803690),l,c,a[h+3],14,-187363961),d,l,a[h+8],20,1163531501),f=v(f,d=v(d,l=v(l,c,f,d,a[h+13],5,-1444681467),c,f,a[h+2],9,-51403784),l,c,a[h+7],14,1735328473),d,l,a[h+12],20,-1926607734),f=g(f,d=g(d,l=g(l,c,f,d,a[h+5],4,-378558),c,f,a[h+8],11,-2022574463),l,c,a[h+11],16,1839030562),d,l,a[h+14],23,-35309556),f=g(f,d=g(d,l=g(l,c,f,d,a[h+1],4,-1530992060),c,f,a[h+4],11,1272893353),l,c,a[h+7],16,-155497632),d,l,a[h+10],23,-1094730640),f=g(f,d=g(d,l=g(l,c,f,d,a[h+13],4,681279174),c,f,a[h+0],11,-358537222),l,c,a[h+3],16,-722521979),d,l,a[h+6],23,76029189),f=g(f,d=g(d,l=g(l,c,f,d,a[h+9],4,-640364487),c,f,a[h+12],11,-421815835),l,c,a[h+15],16,530742520),d,l,a[h+2],23,-995338651),f=y(f,d=y(d,l=y(l,c,f,d,a[h+0],6,-198630844),c,f,a[h+7],10,1126891415),l,c,a[h+14],15,-1416354905),d,l,a[h+5],21,-57434055),f=y(f,d=y(d,l=y(l,c,f,d,a[h+12],6,1700485571),c,f,a[h+3],10,-1894986606),l,c,a[h+10],15,-1051523),d,l,a[h+1],21,-2054922799),f=y(f,d=y(d,l=y(l,c,f,d,a[h+8],6,1873313359),c,f,a[h+15],10,-30611744),l,c,a[h+6],15,-1560198380),d,l,a[h+13],21,1309151649),f=y(f,d=y(d,l=y(l,c,f,d,a[h+4],6,-145523070),c,f,a[h+11],10,-1120210379),l,c,a[h+2],15,718787259),d,l,a[h+9],21,-343485551),l=l+m>>>0,c=c+b>>>0,f=f+k>>>0,d=d+w>>>0}return t.endian([l,c,f,d])};i._ff=function(e,t,n,r,o,i,u){var a=e+(t&n|~t&r)+(o>>>0)+u;return(a<<i|a>>>32-i)+t},i._gg=function(e,t,n,r,o,i,u){var a=e+(t&r|n&~r)+(o>>>0)+u;return(a<<i|a>>>32-i)+t},i._hh=function(e,t,n,r,o,i,u){var a=e+(t^n^r)+(o>>>0)+u;return(a<<i|a>>>32-i)+t},i._ii=function(e,t,n,r,o,i,u){var a=e+(n^(t|~r))+(o>>>0)+u;return(a<<i|a>>>32-i)+t},i._blocksize=16,i._digestsize=16,e.exports=function(e,n){if(void 0===e||null===e)throw new Error("Illegal argument "+e);var r=t.wordsToBytes(i(e,n));return n&&n.asBytes?r:n&&n.asString?o.bytesToString(r):t.bytesToHex(r)}}()}),S={genSign:s,getHeaderSign:a,getPolicyAndAuthorization:l,getPurgeHeaderSign:c},P=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},j=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),C=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();return{Client:function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;P(this,t);var o="undefined"!=typeof window;if(void 0===e.bucketName)throw new Error("upyun - must config bucketName");if("function"==typeof n&&(r=n,n={}),"function"!=typeof r&&o)throw new Error("upyun - must config a callback function getHeaderSign in client side");if(!o&&(void 0===e.operatorName||void 0===e.password))throw new Error("upyun - must config operateName and password in server side");this.isBrowser=o;var i=Object.assign({domain:"v0.api.upyun.com",protocol:"https"},n);this.endpoint=i.protocol+"://"+i.domain,this.req=h(this.endpoint,e,r||d),this.bucket=e,o||this.setBodySignCallback(S.getPolicyAndAuthorization)}return j(t,[{key:"setBucket",value:function(e){this.bucket=e,this.req.defaults.baseURL=this.endpoint+"/"+this.bucketName}},{key:"setBodySignCallback",value:function(e){if("function"!=typeof e)throw new Error("upyun - getBodySign should be a function");this.bodySignCallback=e}},{key:"usage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/";return this.req.get(e+"?usage").then(function(e){var t=e.data;return Promise.resolve(t)})}},{key:"listDir",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.limit,r=void 0===n?100:n,o=t.order,i=void 0===o?"asc":o,u=t.iter,a=void 0===u?"":u,s={"x-list-limit":r,"x-list-order":i};return a&&(s["x-list-iter"]=a),this.req.get(e,{headers:s}).then(function(e){var t=e.data,n=e.headers;if(404===e.status)return!1;var r=n["x-upyun-list-iter"];if(!t)return Promise.resolve({files:[],next:r});var o=t.split("\n").map(function(e){var t=e.split("\t"),n=C(t,4),r=n[0],o=n[1],i=n[2],u=n[3];return{name:r,type:o,size:parseInt(i),time:parseInt(u)}});return Promise.resolve({files:o,next:r})})}},{key:"putFile",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r={};return["Content-MD5","Content-Length","Content-Type","Content-Secret","x-gmkerl-thumb"].forEach(function(e){var t=e.toLowerCase(),o=n[e]||n[t];o?r[e]=o:f(e)&&(r[e]=n[e])}),this.req.put(e,t,{headers:r}).then(function(e){var t=e.headers;if(200!==e.status)return Promise.resolve(!1);var n={};return["x-upyun-width","x-upyun-height","x-upyun-file-type","x-upyun-frames"].forEach(function(e){var r=e.split("x-upyun-")[1];t[e]&&(n[r]=t[e],"file-type"!==r&&(n[r]=parseInt(n[r],10)))}),Promise.resolve(!(Object.keys(n).length>0)||n)})}},{key:"makeDir",value:function(e){return this.req.post(e,null,{headers:{folder:"true"}}).then(function(e){var t=e.status;return Promise.resolve(200===t)})}},{key:"headFile",value:function(e){return this.req.head(e).then(function(e){var t=e.headers;if(404===e.status)return Promise.resolve(!1);var n={};return["x-upyun-file-type","x-upyun-file-size","x-upyun-file-date","Content-Md5"].forEach(function(e){var r=e.split("x-upyun-file-")[1];t[e]&&(n[r]=t[e],"size"!==r&&"date"!==r||(n[r]=parseInt(n[r],10)))}),Promise.resolve(n)})}},{key:"deleteFile",value:function(e){return this.req.delete(e).then(function(e){var t=e.status;return Promise.resolve(200===t)})}},{key:"deleteDir",value:function(e){return this.deleteFile(e)}},{key:"getFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t&&"undefined"!=typeof window)throw new Error("upyun - save as stream are only available on the server side.");return this.req({method:"GET",url:e,responseType:t?"stream":null}).then(function(e){if(404===e.status)return Promise.resolve(!1);if(!t)return Promise.resolve(e.data);var n=e.data.pipe(t);return new Promise(function(e,t){n.on("finish",function(){return e(n)}),n.on("error",t)})})}},{key:"updateMetadata",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"merge",r={};for(var o in t)f(o)?r[o]=t:r["x-upyun-meta-"+o]=t[o];return this.req.patch(e+"?metadata="+n,null,{headers:r}).then(function(e){var t=e.status;return Promise.resolve(200===t)})}},{key:"getMetadata",value:function(e){return this.req.get(e).then(function(e){var t=e.headers;if(200!==e.status)return Promise.resolve(!1);var n={};for(var r in t)f(r)&&(n[r]=t[r]);return Promise.resolve(n)})}},{key:"blockUpload",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=void 0,i=void 0;return"undefined"!=typeof window?(o=Promise.resolve(t.size),i=t.type):(o=p.getFileSizeAsync(t),i=p.getContentType(t)),o.then(function(o){Object.assign(r,{"x-upyun-multi-stage":"initiate","x-upyun-multi-length":o,"x-upyun-multi-type":i});var u=Math.ceil(o/1048576);return n.req.put(e,null,{headers:r}).then(function(r){for(var i=r.headers,a=i["x-upyun-multi-uuid"],s=i["x-upyun-next-part-id"],l=Promise.resolve(s),c=0;c<u;c++)l=l.then(function(r){var i=1048576*r,u=Math.min(i+1048576,o);return p.readBlockAsync(t,i,u).then(function(t){return n.req.put(e,t,{headers:{"x-upyun-multi-stage":"upload","x-upyun-multi-uuid":a,"x-upyun-part-id":r}}).then(function(e){var t=e.headers;return r=t["x-upyun-next-part-id"],Promise.resolve(r)})})});return l.then(function(){return n.req.put(e,null,{headers:{"x-upyun-multi-stage":"complete","x-upyun-multi-uuid":a}}).then(function(e){var t=e.status;return Promise.resolve(204===t||201===t)})})})})}},{key:"formPutFile",value:function(e,t){var r=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("function"!=typeof this.bodySignCallback)throw new Error("upyun - must setBodySignCallback first!");o.bucket=this.bucket.bucketName,o["save-key"]=e;var i=this.bodySignCallback(this.bucket,o);return"function"!=typeof i.then&&(i=Promise.resolve(i)),i.then(function(e){return n(r.endpoint+"/"+o.bucket,t,e).then(function(e){return Promise.resolve(e)})})}},{key:"purge",value:function(t){"string"==typeof t&&(t=[t]);var n=S.getPurgeHeaderSign(this.bucket,t);return e.post("http://purge.upyun.com/purge/","purge="+t.join("\n"),{headers:n}).then(function(e){var t=e.data;if(0===Object.keys(t.invalid_domain_of_url).length)return!0;throw new Error("some url purge failed "+t.invalid_domain_of_url.join(" "))},function(e){throw new Error("upyun - request failed: "+e.message)})}}]),t}(),sign:S,Bucket:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";P(this,e),this.bucketName=t,this.operatorName=n,this.password=A(r)}}});